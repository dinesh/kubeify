
{% if (jekyll.environment == "production") or (site.github.environment == 'dotcom') %}
  <script type="text/javascript">
    !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
    analytics.load("A94pz8RSLIv8dZVQt6qWfnDlEvgJMfO1");
    analytics.page()
    }}();
  </script>

  <script type="text/javascript">
    function getUrlVars(href){
      var vars = [], hash, q;
      q = href.split('?')[1];
      
      if(q != undefined){
        var hashes = q.split('&');
        for(var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
        }
      }
      return vars;
    };

    $(document).on('ready', function(){
      analytics.ready(function(){
        var mx_user_id = mixpanel.get_distinct_id();
        $('.callback').find('.btn').each(function(){
          var element = $(this), href = element.attr('href'), params = getUrlVars(href), newhref;

          if(params['mx_user_id'] == undefined){
            var delimiter = params.length == 0 ? '?' : '&';
            newhref = href + delimiter + "mx_user_id=" + mx_user_id;
            element.prop('href', newhref);
          };
        });
      });
    });
  </script>
{% endif %}

